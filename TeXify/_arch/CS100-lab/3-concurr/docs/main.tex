% 1-2-reasoning.tex

%%%%%%%%%%%%%%%%%%%%
\documentclass[a4paper, justified]{tufte-handout}
\input{hw-preamble} % feel free to modify this file
\newcommand{\ttt}[0]{\texttt}
%%%%%%%%%%%%%%%%%%%%
\title{Parallel Threads}
\me{Guangwei Zhang}{20221001980}{}{}
%%%%%%%%%%%%%%%%%%%%
\begin{document}
\maketitle

\section{Exercise 1.}

\begin{verbatim}
class Algo1:
  halt = 0
  x = 0
 
  def t1(self):
    a = self.x
    a = a + 5
    self.x = a
 
  def t2(self):
    b = self.x
    b = b + 10
    self.x = b
\end{verbatim}

This is possible by $\ttt{t1}\rightarrow \ttt{t2} \rightarrow \ttt{t2}\rightarrow \ttt{t2}\rightarrow \ttt{t1}\rightarrow \ttt{t1}$.

This is the rightmost node at the graph shown in $\ttt{1.html}$

\section{Exercise 2.}

\begin{verbatim}
class Algo2:
    halt = 0
    x = 5
    y = 10
    z = 30
    sum = 0
   
    def t1(self):
      val1 = self.sum + self.x
      self.sum = val1
   
    def t2(self):
      val1 = self.sum + self.y
      self.sum = val1
   
    def t3(self):
      val1 = self.sum + self.z
      self.sum = val1
\end{verbatim}

\textbf{Part 1.} This is possible by $\ttt{t2}\rightarrow \ttt{t3} \rightarrow \ttt{t3}\rightarrow \ttt{t2}\rightarrow \ttt{t1}\rightarrow \ttt{t1}$, which got the sum 15. 




\textbf{Part 2.} This is possible by $\ttt{t2}\rightarrow \ttt{t3} \rightarrow \ttt{t1}\rightarrow \ttt{t1}\rightarrow \ttt{t2}\rightarrow \ttt{t3}$

This is verified by states on $\ttt{2.html}$. 

\section{Exercise 3.}

\begin{verbatim}
class Algo3:
  halt = 0
  turn = ''
  x = 0
 
  def t1(self):
    self.turn = 't1'
    while self.turn == 't2':
      pass
    a = self.x
    a = a + 5
    self.x = a
    self.turn = 't2'
 
  def t2(self):
    self.turn = 't2'
    while self.turn == 't1':
      pass
    b = self.x
    b = b + 10
    self.x = b
    self.turn = 't1'
\end{verbatim}

One possible path is $\ttt{t2}\rightarrow \ttt{t2}\rightarrow\ttt{t1}\rightarrow\ttt{t1}\rightarrow\ttt{t1}\rightarrow\ttt{t1}\rightarrow\ttt{t2}\rightarrow\ttt{t2}\rightarrow\ttt{t1}\rightarrow\ttt{t2}\rightarrow\ttt{1}\rightarrow\ttt{2}$

This is verified by states on $\ttt{3.html}$. As red nodes on $\ttt{3-marked.html}$ shows the problem in critical section(marked by CS).

Using Peterson algorithm can make sure the addition is atomic. 


\section{Note}

The model-checker is by teacher Yanyan Jiang from Nanjing University on the operating system course. 

\begin{itemize}
    \item Model checker by Yanyan Jiang(Download at \url{http://jyywiki.cn/pages/OS/2022/demos/model-checker.py} and \url{http://jyywiki.cn/pages/OS/2022/demos/visualize.py}), slightly modified by Guangwei Zhang (added halting indication)
    \item Example programs \url{http://jyywiki.cn/pages/OS/2022/demos/mutex-bad.py} 
    \item Use command \texttt{./model-checker.py | ./visualize.py > output.html} to visualize. 
\end{itemize}

Adopted version is at \texttt{prog-visualize} folder. 

\end{document}